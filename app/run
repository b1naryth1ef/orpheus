#!/usr/bin/env python
import sys, os

USAGE = "Usage: ./run <web|tests|sched|once>"

def main():
    if not len(sys.argv) > 1:
        print USAGE
        sys.exit(1)

    if sys.argv[1] == "web":
        from emporium import app, setup, get_js_templates
        setup()
        app.run("0.0.0.0", debug=True, extra_files=list(get_js_templates()))
        sys.exit(0)

    if sys.argv[1] == "tests":
        os.system("python -m unittest discover tests '*.py'")
        sys.exit(0)

    if sys.argv[1] == "sched":
        from scheduler.run import sched
        sched.run()
        sys.exit(0)

    if sys.argv[1] == "once":
        import scheduler.run

        if len(sys.argv) < 3:
            print "Usage: ./run.py once <task>"
            sys.exit(1)

        if sys.argv[2] in dir(scheduler.run):
            getattr(globals()["scheduler"].run, sys.argv[2])() 
        sys.exit(0)

    print USAGE
    sys.exit(1)

if __name__ == "__main__":
    main()
